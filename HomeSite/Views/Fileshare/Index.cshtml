@model FileShareViewModel
@{
	ViewData["Title"] = "File share";
}
@using HomeSite.Helpers
<link rel="stylesheet" href="~/css/filedisk.css?v=1" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
<div class="row">
    <!-- Боковая панель -->
    <div class="col-md-2 sidebar p-0">
        <div class="d-flex flex-column p-3">
            <!-- Круговой прогресс бар -->
            <div class="storage-info">
                <div class="progress-circle">
                    <svg>
                        <circle class="progress-circle-bg" cx="60" cy="60" r="50"></circle>
                <circle class="progress-circle-fill" cx="60" cy="60" r="50" style="--progress: @Model.percentUsed"></circle>
                    </svg>
                    <div class="progress-circle-text">
                        <h5>@Model.percentUsed%</h5>
                        <small>@Model.SpaceUsed/1 ГБ</small>
                    </div>
                </div>
            </div>
                    
            <div class="sidebar-buttons">
                <button class="btn btn-green w-100 mb-3 fw-bold text-white">
                    <i class="bi bi-plus-lg me-2 text-white"></i> Загрузить
                </button>
                        
                <ul class="nav nav-pills flex-column mb-auto">
                    <li class="nav-item">
                        <a href="#" class="nav-link sidebar-link active">
                            <i class="bi bi-folder-fill me-2"></i> Все файлы
                        </a>
                    </li>
@*                     <li>
                        <a href="#" class="nav-link sidebar-link">
                            <i class="bi bi-star-fill me-2"></i> Избранное
                        </a>
                    </li>
                    <li>
                        <a href="#" class="nav-link sidebar-link">
                            <i class="bi bi-clock-fill me-2"></i> Недавние
                        </a>
                    </li>
                    <li>
                        <a href="#" class="nav-link sidebar-link">
                            <i class="bi bi-share-fill me-2"></i> Общий доступ
                        </a>
                    </li>
                    <li>
                        <a href="#" class="nav-link sidebar-link">
                            <i class="bi bi-trash-fill me-2"></i> Корзина
                        </a>
                    </li> *@
                </ul>
            </div>
        </div>
    </div>

    <!-- Основное содержимое -->
    <div class="col-md-10 p-4">
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#"><i class="bi bi-house-door-fill"></i></a></li>
@*                 <li class="breadcrumb-item"><a href="#">Мои файлы</a></li>
                <li class="breadcrumb-item active" aria-current="page">Документы</li> *@
            </ol>
        </nav>
                
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="m-0">Мои файлы</h4>
@*             <div>
                <button class="btn btn-sm btn-outline-secondary me-2">
                    <i class="bi bi-grid-fill"></i>
                </button>
                <button class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-list-ul"></i>
                </button>
            </div> *@
        </div>
                
        <!-- Список файлов -->
        <div class="row g-4">
            @if (Model.Files == null || Model.Files.Count == 0)
            {
                <span>У тебя еще нет файлов</span>
            }
            else
            {
                @foreach (var file in Model.Files)
                {
                    <div class="col-xxl-2 col-xl-3 col-lg-4 col-md-6 col-sm-6">
                        <div class="file-card p-3 h-100" oncontextmenu="showContextMenu(event, this)" data-fileId="@file.FileId" data-share="@file.Share" data-feat="@file.Featured">
                            <div class="d-flex flex-column align-items-center text-center">
                                @if (file.Featured)
                                {
                                    <i id="feat-star" class="bi file-icon bi-star-fill position-absolute align-self-start" style="font-size: 1.1rem;"></i>
                                }
                                <i id="fileicon" class="bi @Helper.GetIconClass(file.Extension!) file-icon mb-2"></i>
                                <h6 id="filename" class="mb-1">@file.OriginalName</h6>
                                <small class="text-muted">@Helper.FormatFileSize(file.Size)</small>
                                <small class="text-muted">@file.DateUploaded.ToShortDateString()</small>
                            </div>
                        </div>
                    </div>
                }
            }
        </div>
        <!-- Контекстное меню -->
        <div id="contextMenu" class="context-menu">
            <div class="context-menu-item" id="dwld-div"><i class="bi bi-download me-2"></i>Скачать</div>
            <div class="context-menu-item" id="feat-div"><i class="bi bi-star me-2"></i>Избранное</div>
            <div class="context-menu-item" id="share-div"><i class="bi bi-share me-2"></i>Поделиться</div>
            <div class="context-menu-item" id="rename-div"><i class="bi bi-pencil me-2"></i>Переименовать</div>
            <div class="context-menu-item text-danger" id="delete-div"><i class="bi bi-trash me-2"></i>Удалить</div>
        </div>
    </div>
</div>

<!-- Модальное окно загрузки -->
<div class="modal fade" id="uploadModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bg-dark">
            <div class="modal-header border-0">
                <h5 class="modal-title">Загрузить файлы</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="border border-dashed rounded p-4 text-center mb-3" id="dropZone">
                    <i class="bi bi-cloud-arrow-up text-muted" style="font-size: 3rem;"></i>
                    <p class="mt-3">Перетащите файлы сюда или</p>
                    <input type="file" class="form-control d-none" id="inputGroupFile04" aria-describedby="fileSendBtn" aria-label="Upload">
                    <button class="btn btn-green text-white" type="button" id="customFileBtn">Выбрать файлы</button>
                </div>
                <div class="row g-3 d-flex flex-column align-items-center" id="filePreviewContainer"></div>
                <div class="d-flex flex-column align-items-center my-2">
                    <button id="fileSendBtn" class="btn btn-green w-25 text-white">Загрузить</button>
                </div>
                <div class="progress mb-2" style="height: 6px;">
                    <div class="progress-bar progress-bar-green" role="progressbar" style="width: 0%;"></div>
                </div>
                <small style="margin-top: -5px;" id="errorUplSpan" class="text-danger align-self-center hideFZ">Ошибка</small>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="shareModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bg-dark">
            <div class="modal-header border-0">
                <h5 class="modal-title">Поделиться файлом</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>
                    <i class="bi bi-lock me-2"></i>Изменить доступ к файлу
                </p>
                <div class="input-group mb-3">
                    <span class="input-group-text">
                        <i class="bi bi-people-fill"></i>
                    </span>
                    <select class="form-select" id="shareSelect">
                        <option value="False">Только я</option>
                        <option value="True">Все, у кого есть ссылка</option>
                    </select>
                </div>
                <div class="input-group" style="max-width: 500px;">
                    <span class="input-group-text">
                        <i class="bi bi-link-45deg"></i>
                    </span>
                    <button id="copyLink" class="form-control d-flex align-items-center justify-content-center">
                        <i class="bi bi-clipboard"></i>
                    </button>
                </div>
                <small style="margin-top: -5px;" id="shareSpan" class="text-green align-self-center hideFZ">
                    <i class="bi bi-check-circle-fill me-1"></i>Сохранено
                </small>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="renameModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bg-dark">
            <div class="modal-header border-0">
                <h5 class="modal-title">Переименовать файл</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" onclick="renameInput.value = ''"></button>
            </div>
            <div class="modal-body">
                <p>
                    <i class="bi bi-pencil-square me-2"></i>Изменить название файла
                </p>
                <span>
                    <i class="bi bi-file-earmark-text me-1"></i>Старое название:
                    <span id="fileSpan" class="fw-bold">dfgdgfdgfgdf.txt</span>
                </span>

                <div class="form-floating mb-3 mt-3">
                    <input type="text" class="form-control" id="newNameInput" placeholder="">
                    <label for="newNameInput">
                        <i class="bi bi-input-cursor-text me-1"></i>Новое название файла
                    </label>
                </div>

                <div class="d-flex flex-column align-items-center my-2">
                    <button id="fileRenameBtn" class="btn btn-green w-50 text-white">
                        <i class="bi bi-arrow-repeat me-1"></i>Переименовать
                    </button>
                </div>

                <small style="margin-top: -5px;" id="renameSpan" class="text-green align-self-center hideFZ">
                    <i class="bi bi-check-circle-fill me-1"></i>
                </small>
            </div>
        </div>
    </div>
</div>
<script src="~/js/fileShare.js?v=5"></script>